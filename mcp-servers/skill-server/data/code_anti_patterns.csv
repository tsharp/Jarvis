pattern_id,pattern_signature,trigger_condition,risk_severity,negative_example,positive_example,refactoring_steps
ANTI-PY-01,subprocess.call(shell=True),"User input passed to shell commands.","Critical","subprocess.call('ls ' + user_input, shell=True)","subprocess.call(['ls', user_input])","[""replace shell=True with shell=False"", ""pass args as a list"", ""validate input""]"
ANTI-PY-02,eval(),"Dynamic code execution of untrusted strings.","Critical","eval(user_expression)","ast.literal_eval(user_expression)","[""Remove eval()"", ""Use ast.literal_eval for safe literal parsing"", ""Use a math parser library for expressions""]"
ANTI-PY-03,exec(),"Execution of arbitrary Python code blocks.","Critical","exec(user_code)","(No safe alternative for arbitrary code)","[""Remove exec() completely"", ""Refactor to use defined functions or dispatcher pattern""]"
ANTI-PY-04,os.system(),"Legacy shell execution, vulnerable to injection.","High","os.system('echo ' + user_input)","subprocess.run(['echo', user_input])","[""Replace os.system with subprocess.run"", ""Pass arguments as list"", ""Check return codes""]"
ANTI-PY-05,yaml.load(),"Unsafe YAML deserialization can execute code.","High","yaml.load(stream)","yaml.safe_load(stream)","[""Replace yaml.load with yaml.safe_load"", ""Update PyYAML dependency""]"
ANTI-PY-06,pickle.load(),"Pickle can execute arbitrary code during deserialization.","Critical","pickle.load(file)","json.load(file)","[""Replace pickle with JSON or Protocol Buffers"", ""Do not unpickle untrusted data""]"
ANTI-PY-07,input(),"Blocking call triggers interactivity, stalling headless agents.","Medium","name = input('Enter name:')","name = event.get('name')","[""Remove input()"", ""Read from function arguments or environment variables""]"
ANTI-PY-08,while True:,"Potential infinite loop if break condition fails.","High","while True:\n    do_work()","for _ in range(MAX_ITERATIONS):\n    do_work()","[""Replace while True with for loop with max iterations"", ""Add timeout check inside loop""]"
ANTI-PY-09,except:,"Bare except swipes all errors (including SystemExit).","Medium","try:\n    risky()\nexcept:\n    pass","try:\n    risky()\nexcept ValueError:\n    handle_error()","[""Catch specific exceptions (e.g., ValueError, IOError)"", ""Log the exception"", ""Don't swallow SystemExit""]"
ANTI-PY-10,print(),"Unstructured logging makes observability difficult.","Low","print('Error: ' + str(e))","logger.error({'error': str(e), 'context': ctx})","[""Use structured logging library (structlog or python-json-logger)"", ""Log as JSON"", ""Include context""]"
ANTI-PY-11,api_key = "sk-...","Hardcoded secrets in source code.","Critical","api_key = 'sk-12345'","api_key = os.getenv('API_KEY')","[""Move secret to environment variable"", ""Use secrets manager"", ""Rotate exposed key""]"
ANTI-PY-12,password = "...","Hardcoded passwords.","Critical","db_pass = 'admin123'","db_pass = os.getenv('DB_PASS')","[""Move secret to environment variable"", ""Use secrets manager""]"
ANTI-PY-13,start_server(0.0.0.0),"Binding to all interfaces exposes service publicly.","High","app.run(host='0.0.0.0')","app.run(host='127.0.0.1')","[""Bind to localhost (127.0.0.1) by default"", ""Configure firewall rules if public access needed""]"
ANTI-PY-14,verify=False,"Disabling SSL verification allows MITM attacks.","High","requests.get(url, verify=False)","requests.get(url, verify=True)","[""Remove verify=False"", ""Install proper CA certificates if needed""]"
ANTI-PY-15,tempfile.mktemp(),"Insecure temporary file creation (race condition).","Medium","f = tempfile.mktemp()","f = tempfile.mkstemp()","[""Use tempfile.mkstemp()"", ""Use tempfile.TemporaryFile context manager""]"
ANTI-PY-16,random.seed(time),"Time-based seeding makes tests flaky and predictable.","Medium","random.seed(time.time())","random.seed(42)","[""Use fixed seed for determinism"", ""Pass seed as argument""]"
ANTI-PY-17,Mutable Default Arg,"Mutable default arguments persist state across calls.","Medium","def foo(l=[]):\n    l.append(1)","def foo(l=None):\n    if l is None: l = []","[""Change default arg to None"", ""Initialize mutable inside function""]"
ANTI-PY-18,Open without ctx,"File handles may leak if not closed explicitly.","Medium","f = open('file.txt')\nf.write(data)","with open('file.txt') as f:\n    f.write(data)","[""Use 'with' statement context manager"", ""Ensure prompt closing in finally block""]"
